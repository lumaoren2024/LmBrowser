import{k as G,c as t,K as ve,i as n,F as R,O as ee,a7 as Te,a8 as Ne,a9 as Oe,aa as Ee,ab as ze,S as he,b as P,d as m,a3 as J,a0 as Ke,a1 as Me,N as pe,q as Ce,ac as te,ad as ke,ae as Ge,m as Re,af as je,ag as Ae,ah as Le,$ as Ve,ai as He,T as ie,h as q,j as Ue,p as Be,a5 as qe,A as z,g as L,t as V,aj as We,ak as Ze,M as Ye,P as X,al as ce,am as de,an as Je,ao as Xe,D as Qe,e as et}from"./vendor-6rLqdkxq.js";import{c as tt,g as nt,a as at,b as rt,d as st,e as lt,f as W,r as ot}from"./index-BISvbaWk.js";import{u as Z,B as T,f as it,g as ct,h as dt,T as ut,i as H,j as $e,k as _e,M as Se,m as ne,c as gt,n as mt,o as u,p as ue,q as ge,r as me,v as ft,w as bt,x as vt,y as ht}from"./index-BWze4VzI.js";import{C as Q}from"./ConfigTitle-C0Nf-ceG.js";import{f as pt}from"./global-Dt3RF34O.js";var Ct=m('<form><div class="join flex"><select name=sourceIP class="join-item select select-bordered"><option></option></select><input name=tagName class="input join-item input-bordered min-w-0 flex-1"placeholder=name>'),$t=m("<option class=badge>"),_t=m('<div><div class="flex justify-between py-2"><div class="flex items-center gap-2"><span></span></div><input type=checkbox class=toggle>'),St=m("<div>"),xt=m('<div class="flex flex-col gap-4"><div><select class="select select-bordered w-full"></select></div><div><div class="flex flex-col gap-4"><div class="flex flex-col gap-2"></div></div></div><div>'),It=m("<option>"),yt=m('<div class="badge badge-primary w-full items-center justify-between gap-2 py-4"><span class=truncate> (<!>)');const wt=()=>{const s=J.object({tagName:J.string().nonempty(),sourceIP:J.string().nonempty()}),[g]=Z(),{form:f,reset:r}=Ke({extend:Me({schema:s}),onSubmit:({tagName:v,sourceIP:F})=>{$e($=>$.some(o=>o.tagName===v||o.sourceIP===F)?$:[...$,{tagName:v,sourceIP:F}]),r()}});return(()=>{var v=Ct(),F=v.firstChild,$=F.firstChild;return $.firstChild,$.nextSibling,pe(f,v,()=>f),n($,t(te,{get each(){return Ce.uniq(ne().map(({metadata:{sourceIP:o}})=>o)).sort().filter(o=>!H().some(({sourceIP:i})=>i===o))},children:o=>(()=>{var i=$t();return n(i,o),P(()=>i.value=o()),i})()}),null),n(F,t(T,{type:"submit",class:"join-item",get children(){return g("tag")}}),null),v})()},Ft=s=>{const[g]=Z(),[f,r]=G(null),v=({draggable:o})=>r(o.id),F=({draggable:o,droppable:i})=>{if(o&&i){const _=s.order,h=_.indexOf(o.id),I=_.indexOf(i.id);if(h!==I){const S=_.slice();S.splice(I,0,...S.splice(h,1)),s.onOrderChange(S)}}},$=({key:o})=>{const i=ke(o),[_]=Ge();return(()=>{var h=_t(),I=h.firstChild,S=I.firstChild,K=S.firstChild,b=S.nextSibling,y=i.ref;return typeof y=="function"?pe(y,h):i.ref=h,n(S,t(T,Re({class:"btn-ghost btn-sm cursor-grab",get icon(){return t(je,{size:24})}},()=>i.dragActivators)),K),n(K,()=>g(o)),b.addEventListener("change",p=>{s.onVisibleChange({...s.visible,[o]:p.target.checked})}),P(p=>{var N=!!i.isActiveDraggable,M=!!_.active.draggable,w=Ae(i.transform);return N!==p.e&&h.classList.toggle("opacity-25",p.e=N),M!==p.t&&h.classList.toggle("transition-transform",p.t=M),p.a=Le(h,w,p.a),p},{e:void 0,t:void 0,a:void 0}),P(()=>b.checked=s.visible[o]),h})()};return t(Se,{ref:o=>{var i;return(i=s.ref)==null?void 0:i.call(s,o)},get icon(){return t(ve,{size:24})},get title(){return g("connectionsSettings")},get action(){return t(T,{class:"btn-neutral btn-sm",onClick:()=>{s.onOrderChange(it),s.onVisibleChange(ct)},get children(){return g("reset")}})},get children(){var o=xt(),i=o.firstChild,_=i.firstChild,h=i.nextSibling,I=h.firstChild,S=I.firstChild,K=h.nextSibling;return n(i,t(Q,{withDivider:!0,get children(){return g("tableSize")}}),_),_.addEventListener("change",b=>dt(b.target.value)),n(_,t(R,{get each(){return Object.values(ut)},children:b=>(()=>{var y=It();return y.value=b,n(y,()=>g(b)),y})()})),n(h,t(Q,{withDivider:!0,get children(){return g("tagClientSourceIPWithName")}}),I),n(I,t(wt,{}),S),n(S,t(R,{get each(){return H()},children:({tagName:b,sourceIP:y})=>(()=>{var p=yt(),N=p.firstChild,M=N.firstChild,w=M.nextSibling;return w.nextSibling,n(N,b,M),n(N,y,w),n(p,t(T,{class:"btn-circle btn-ghost btn-xs",onClick:()=>$e(j=>j.filter(A=>A.tagName!==b)),get icon(){return t(ee,{size:12})}}),null),p})()})),n(K,t(Q,{withDivider:!0,get children(){return g("sort")}}),null),n(K,t(Te,{onDragStart:v,onDragEnd:F,collisionDetector:Ne,get children(){return[t(Oe,{}),t(Ee,{get ids(){return s.order},get children(){return t(R,{get each(){return s.order},children:b=>t($,{key:b})})}}),t(ze,{get children(){return t(he,{get when(){return f()},get children(){var b=St();return n(b,()=>g(f())),b}})}})]}}),null),P(()=>_.value=_e()),o}})};var Dt=m("<pre><code>");const Pt=s=>{const[g]=Z();return t(Se,{ref:f=>{var r;return(r=s.ref)==null?void 0:r.call(s,f)},get icon(){return t(ve,{size:24})},get title(){return g("connectionsDetails")},get children(){return t(he,{get when(){return s.selectedConnectionID},get children(){var f=Dt(),r=f.firstChild;return n(r,()=>JSON.stringify(ne().find(({id:v})=>v===s.selectedConnectionID),null,2)),f}})}})};var Tt=async s=>{typeof s=="string"?await navigator.clipboard.writeText(s):await navigator.clipboard.write(s)},fe=m('<div class="flex h-4 items-center">'),Nt=m('<div class="flex h-full flex-col gap-2"><div class="flex w-full flex-wrap items-center gap-2"><div class="flex items-center gap-2"><div class="tabs-boxed tabs gap-2"></div><select class="select select-bordered select-primary select-sm w-full max-w-full flex-1 sm:select-md"><option value=""></option></select></div><div class="join flex flex-1 items-center md:flex-1"><input type=search class="input input-sm join-item input-primary min-w-0 flex-1 sm:input-md"></div></div><div class="overflow-x-auto whitespace-nowrap rounded-md bg-base-300"><table><thead class="sticky top-0 z-10 h-8"></thead><tbody>'),Ot=m('<button><span></span><div class="badge badge-sm">'),Et=m("<option>"),zt=m("<tr>"),Kt=m("<th class=bg-base-200><div><div>"),Mt=m("<button class=cursor-pointer>"),kt=m('<tr class="hover:!bg-primary hover:text-primary-content">'),Gt=m("<td class=py-2>"),Rt=m("<button><div></div><div></div><div>(<!>)");const be=(s,g,f,r)=>{const v=ot(s.getValue(g),f);return r({itemRank:v}),v.passed},Ut=()=>{const s=Ve();if(!gt())return s("/setup",{replace:!0}),null;let g,f;const[r]=Z(),[v,F]=G(0),{activeConnections:$,closedConnections:o,paused:i,setPaused:_}=mt(),[h,I]=G(""),[S,K]=G(),b=[{header:()=>r("details"),enableGrouping:!1,enableSorting:!1,enableColumnFilter:!1,enableGlobalFilter:!1,accessorKey:u.Details,cell:({row:e})=>(()=>{var c=fe();return n(c,t(T,{class:"btn-circle btn-xs",onClick:()=>{K(e.original.id),f==null||f.showModal()},get icon(){return t(He,{size:"16"})}})),c})()},{header:()=>r("close"),enableGrouping:!1,enableSorting:!1,enableColumnFilter:!1,enableGlobalFilter:!1,accessorKey:u.Close,cell:({row:e})=>(()=>{var c=fe();return n(c,t(T,{class:"btn-circle btn-xs",onClick:()=>ue(e.original.id),get icon(){return t(ee,{size:"16"})}})),c})()},{header:()=>r("ID"),enableGrouping:!1,accessorKey:u.ID,accessorFn:e=>e.id},{header:()=>r("type"),accessorKey:u.Type,accessorFn:e=>`${e.metadata.type}(${e.metadata.network})`},{header:()=>r("process"),accessorKey:u.Process,accessorFn:e=>e.metadata.process||e.metadata.processPath.replace(/^.*[/\\](.*)$/,"$1")||"-"},{header:()=>r("host"),accessorKey:u.Host,accessorFn:e=>`${e.metadata.host?e.metadata.host:e.metadata.destinationIP}:${e.metadata.destinationPort}`},{header:()=>r("sniffHost"),accessorKey:u.SniffHost,accessorFn:e=>e.metadata.sniffHost||"-"},{header:()=>r("rules"),accessorKey:u.Rule,accessorFn:e=>e.rulePayload?`${e.rule} :: ${e.rulePayload}`:e.rule},{header:()=>r("chains"),accessorKey:u.Chains,accessorFn:e=>e.chains.slice().reverse().join(" :: ")},{header:()=>r("connectTime"),enableGrouping:!1,accessorKey:u.ConnectTime,accessorFn:e=>pt(e.start),sortingFn:(e,c)=>ie(e.original.start).valueOf()-ie(c.original.start).valueOf()},{header:()=>r("dlSpeed"),enableGrouping:!1,accessorKey:u.DlSpeed,accessorFn:e=>`${q(e.downloadSpeed)}/s`,sortingFn:(e,c)=>e.original.downloadSpeed-c.original.downloadSpeed},{header:()=>r("ulSpeed"),enableGrouping:!1,accessorKey:u.ULSpeed,accessorFn:e=>`${q(e.uploadSpeed)}/s`,sortingFn:(e,c)=>e.original.uploadSpeed-c.original.uploadSpeed},{header:()=>r("dl"),enableGrouping:!1,accessorKey:u.Download,accessorFn:e=>q(e.download),sortingFn:(e,c)=>e.original.download-c.original.download},{header:()=>r("ul"),enableGrouping:!1,accessorKey:u.Upload,accessorFn:e=>q(e.upload),sortingFn:(e,c)=>e.original.upload-c.original.upload},{header:()=>r("sourceIP"),accessorKey:u.SourceIP,accessorFn:e=>{const c=H().find(U=>U.sourceIP===e.metadata.sourceIP);return c?c.tagName:e.metadata.sourceIP}},{header:()=>r("sourcePort"),accessorKey:u.SourcePort,accessorFn:e=>e.metadata.sourcePort},{header:()=>r("destination"),accessorKey:u.Destination,accessorFn:e=>e.metadata.remoteDestination||e.metadata.destinationIP||e.metadata.host},{header:()=>r("inboundUser"),accessorKey:u.InboundUser,accessorFn:e=>e.metadata.inboundUser||e.metadata.inboundName||e.metadata.inboundPort}],[y,p]=G([]),[N,M]=Ue(G([{id:u.ConnectTime,desc:!0}]),{name:"connectionsTableSorting",storage:localStorage}),w=tt({filterFns:{fuzzy:be},state:{get columnOrder(){return ge()},get grouping(){return y()},get sorting(){return N()},get columnVisibility(){return me()},get globalFilter(){return h()}},get data(){return v()===0?$():o()},sortDescFirst:!0,enableHiding:!0,columns:b,onGlobalFilterChange:I,globalFilterFn:be,onGroupingChange:p,onSortingChange:M,getFilteredRowModel:nt(),getSortedRowModel:at(),getExpandedRowModel:rt(),getGroupedRowModel:st(),getCoreRowModel:lt()}),j=w.getFlatHeaders().find(({id:e})=>e===u.SourceIP),[A,xe]=G("");Be(qe(A,()=>{const e=H().find(c=>c.sourceIP===A());j==null||j.column.setFilterValue(e?e.tagName:A())}));const Ie=z(()=>[{type:0,name:r("active"),count:$().length},{type:1,name:r("closed"),count:o().length}]);return(()=>{var e=Nt(),c=e.firstChild,U=c.firstChild,ae=U.firstChild,Y=ae.nextSibling,ye=Y.firstChild,B=U.nextSibling,re=B.firstChild,we=c.nextSibling,se=we.firstChild,le=se.firstChild,Fe=le.nextSibling;return n(ae,t(te,{get each(){return Ie()},children:a=>(()=>{var d=Ot(),l=d.firstChild,O=l.nextSibling;return d.$$click=()=>F(a().type),n(l,()=>a().name),n(O,()=>a().count),P(()=>L(d,V(v()===a().type&&"tab-active","tab-sm sm:tab-md tab gap-2"))),d})()})),Y.addEventListener("change",a=>xe(a.target.value)),n(ye,()=>r("all")),n(Y,t(te,{get each(){return Ce.uniq(ne().map(({metadata:{sourceIP:a}})=>{const d=H().find(l=>l.sourceIP===a);return d?d.tagName:a})).sort()},children:a=>(()=>{var d=Et();return n(d,a),P(()=>d.value=a()),d})()}),null),re.$$input=a=>I(a.target.value),n(B,t(T,{class:"join-item btn-sm sm:btn-md",onClick:()=>_(a=>!a),get icon(){return z(()=>!!i())()?t(We,{}):t(Ze,{})}}),null),n(B,t(T,{class:"join-item btn-sm sm:btn-md",onClick:()=>{w.getState().globalFilter?w.getFilteredRowModel().rows.forEach(({id:a})=>ue(a)):ft()},get icon(){return t(ee,{})}}),null),n(B,t(T,{class:"btn join-item btn-sm sm:btn-md",onClick:()=>g==null?void 0:g.showModal(),get icon(){return t(Ye,{})}}),null),n(le,t(R,{get each(){return w.getHeaderGroups()},children:a=>(()=>{var d=zt();return n(d,t(R,{get each(){return a.headers},children:l=>(()=>{var O=Kt(),E=O.firstChild,C=E.firstChild;return n(E,(()=>{var x=z(()=>!!l.column.getCanGroup());return()=>x()?(()=>{var D=Mt();return X(D,"click",l.column.getToggleGroupingHandler(),!0),n(D,(()=>{var k=z(()=>!!l.column.getIsGrouped());return()=>k()?t(ce,{size:18}):t(de,{size:18})})()),D})():null})(),C),X(C,"click",l.column.getToggleSortingHandler(),!0),n(C,()=>W(l.column.columnDef.header,l.getContext())),n(E,()=>({asc:t(Je,{}),desc:t(Xe,{})})[l.column.getIsSorted()]??null,null),P(x=>{var D=V("flex items-center gap-2"),k=V(l.column.getCanSort()&&"cursor-pointer select-none","flex-1");return D!==x.e&&L(E,x.e=D),k!==x.t&&L(C,x.t=k),x},{e:void 0,t:void 0}),O})()})),d})()})),n(Fe,t(R,{get each(){return w.getRowModel().rows},children:a=>(()=>{var d=kt();return n(d,t(R,{get each(){return a.getVisibleCells()},children:l=>(()=>{var O=Gt();return O.$$contextmenu=E=>{E.preventDefault();const C=l.renderValue();C&&Tt(C).catch(()=>{})},n(O,(()=>{var E=z(()=>!!l.getIsGrouped());return()=>E()?(()=>{var C=Rt(),x=C.firstChild,D=x.nextSibling,k=D.nextSibling,De=k.firstChild,oe=De.nextSibling;return oe.nextSibling,X(C,"click",a.getToggleExpandedHandler(),!0),n(x,(()=>{var Pe=z(()=>!!a.getIsExpanded());return()=>Pe()?t(ce,{size:18}):t(de,{size:18})})()),n(D,()=>W(l.column.columnDef.cell,l.getContext())),n(k,()=>a.subRows.length,oe),P(()=>L(C,V(a.getCanExpand()?"cursor-pointer":"cursor-normal","flex items-center gap-2"))),C})():(()=>{var C=z(()=>!!l.getIsAggregated());return()=>C()?W(l.column.columnDef.aggregatedCell??l.column.columnDef.cell,l.getContext()):(()=>{var x=z(()=>!!l.getIsPlaceholder());return()=>x()?null:W(l.column.columnDef.cell,l.getContext())})()})()})()),O})()})),d})()})),n(e,t(Ft,{ref:a=>g=a,get order(){return ge()},get visible(){return me()},onOrderChange:a=>bt(a),onVisibleChange:a=>vt({...a})}),null),n(e,t(Pt,{ref:a=>f=a,get selectedConnectionID(){return S()}}),null),P(a=>{var d=r("search"),l=V(ht(_e()),"table table-zebra relative rounded-none");return d!==a.e&&Qe(re,"placeholder",a.e=d),l!==a.t&&L(se,a.t=l),a},{e:void 0,t:void 0}),e})()};et(["input","click","contextmenu"]);export{Ut as default};
